/* css/home/Textarea.module.css
   Uses only the root tokens provided by the user (--color-*, --radius-*, etc.)
*/

.wrapper {
  position: fixed;
  bottom: 16px;
  left: 50%;
  transform: translateX(-50%);
  width: calc(100% - 32px);
  max-width: 920px;
  box-sizing: border-box;
  z-index: 1200;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  border-radius: var(--radius-md);
  backdrop-filter: blur(6px);

  /* use root tokens for background / border / shadow */
  background: linear-gradient(180deg, var(--color-bg-surface), var(--color-bg-elev));
  border: var(--border-1) rgba(0,0,0,0.03);
  box-shadow: var(--shadow-1);
  color: var(--color-text);

  transition: background var(--theme-transition), color var(--theme-transition),
              box-shadow var(--theme-transition), transform var(--theme-transition);
}

/* top row */
.topRow {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

/* model chooser */
.modelChooser { position: relative; }

.chooseBtn {
  padding: 8px 12px;
  border-radius: var(--radius-md);
  border: none;
  cursor: pointer;
  font-weight:600;
  display:inline-flex;
  gap:8px;
  align-items:center;

  /* light-ish sheen using tokens */
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.0));
  box-shadow: var(--shadow-1);
  color: var(--color-text);
}

/* chevron */
.chev { opacity:0.7; margin-left:8px; }

/* popup */
.chooserPopup {
  position:absolute;
  left:0;
  transform-origin: bottom left;
  bottom: 64px;
  width:220px;
  pointer-events:none;
  opacity:0;
  transform: translateY(8px) scale(.98);
  transition: transform 220ms cubic-bezier(.2,.9,.2,1), opacity 180ms ease;
  z-index:1300;
}

.chooserPopup.open {
  pointer-events:auto;
  opacity:1;
  transform: translateY(0) scale(1);
}

.popupInner {
  padding:8px;
  background: linear-gradient(180deg, var(--color-bg-surface), var(--color-bg-elev));
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-2);
  border: 1px solid var(--color-border);
  display:flex;
  flex-direction:column;
  gap:6px;
}

/* choices */
.choice {
  padding:8px 10px;
  border-radius: var(--radius-sm);
  border:none;
  text-align:left;
  cursor:pointer;
  font-weight:600;
  background: transparent;
  color: var(--color-text);
}
.choice:hover {
  transform: translateX(6px);
  transition: transform 160ms ease;
  box-shadow: var(--shadow-1);
}

/* composer row */
.textareaRow {
  position: relative;
  display:flex;
  gap:12px;
  align-items:flex-end;
  padding:10px;
  border-radius: var(--radius-md);
  background: transparent;
  box-shadow: inset 0 1px 0 var(--color-inset);
}

/* textarea */
.textarea {
  flex:1;
  min-height:46px;
  max-height:220px;
  resize:none;
  border: 1px solid var(--color-text);
  outline:none;
  padding:12px 14px;
  font-size: var(--fs-base);
  border-radius: var(--radius-sm);
  background: transparent;
  line-height:1.35;
  box-shadow:none;
  color: var(--color-text);

  /* placeholder behavior: single-line while empty */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* once user has typed, allow wrapping */
.textarea:not(:placeholder-shown) {
  white-space: pre-wrap;
  overflow-wrap: anywhere;
}

/* placeholder styling */
.textarea::placeholder {
  opacity: 0.65;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-size: 0.98rem;
  color: var(--color-text-muted);
}

/* send button: circular, uses root tokens so it inverts automatically:
   background = --color-text, foreground = --color-bg  => dark on light, light on dark */
.sendBtn {
  width:48px;
  height:48px;
  padding:0;
  border-radius: 999px;
  border:none;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  transition: transform var(--theme-transition), box-shadow var(--theme-transition), opacity var(--theme-transition);
  box-shadow: var(--shadow-1);

  /* inversion rule: background uses --color-text (dark in light theme, light in dark theme)
     and foreground uses --color-bg (light in light theme, dark in dark theme) */
  background: var(--color-text);
  color: var(--color-bg);
}

/* hover */
.sendBtn:hover {
  box-shadow: var(--shadow-2);
  background: var(--color-text-muted);
}

/* disabled state */
.sendBtn.disabled,
.sendBtn[disabled] {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
  filter: grayscale(0.15);
}

/* small rotate animation for sending state */
.sendingIcon {
  animation: spin 0.9s linear infinite;
}
@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* thin custom scrollbar for textarea */
/* WebKit */
.textarea::-webkit-scrollbar {
  height: 6px;
  width: 6px;
}
.textarea::-webkit-scrollbar-thumb {
  border-radius: 999px;
  background: var(--color-border-strong);
  opacity: 0.9;
}
.textarea::-webkit-scrollbar-track {
  background: transparent;
}

/* Firefox */
.textarea {
  scrollbar-width: thin;
  scrollbar-color: var(--color-border-strong) transparent;
}

/* responsive */
@media (max-width: 760px) {
  .wrapper {
    bottom: 8px;
    width: calc(100% - 16px);
    padding: 10px;
    border-radius: calc(var(--radius-md) - 2px);
  }
  .chooserPopup { width:180px; bottom: 68px; }
  .sendBtn { width:42px; height:42px; }
  .textarea::placeholder { font-size: 0.95rem; }
}

/* large-screen cap */
@media (min-width: 1400px) {
  .wrapper { max-width: 1160px; }
}


/* >>> Add at the top of file (or near popup styles) */
:root {
  /* ensure a consistent choice height we can use to compute max-height */
  --choice-size: 44px; /* includes padding + line-height; tweak if you change .choice padding */
}

/* ---------------- chooser popup (desktop & tablet) ---------------- */
.chooserPopup {
  position: absolute;
  left: 0;
  transform-origin: bottom left;
  bottom: 64px;

  min-width: 280px;
  width: clamp(320px, 36vw, 520px);
  max-width: 520px;

  pointer-events: none;
  opacity: 0;
  transform: translateY(8px) scale(.98);
  transition: transform 220ms cubic-bezier(.2,.9,.2,1), opacity 180ms ease;
  z-index: 1300;
  overflow: visible;
}

.chooserPopup.open {
  pointer-events: auto;
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* inner panel fixed-height for 4 items and scroll */
.popupInner {
  padding: 10px;
  background: linear-gradient(180deg, var(--color-bg-surface), var(--color-bg-elev));
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-2);
  border: 1px solid var(--color-border);
  display: flex;
  flex-direction: column;
  gap: 8px;

  --choice-size: 44px;
  height: calc((var(--choice-size) * 4) + (8px * 3) + 20px);
  max-height: calc((var(--choice-size) * 4) + (8px * 3) + 20px);

  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  padding-right: 12px;
  box-sizing: border-box;
}

/* choice item */
.choice {
  padding: 8px 12px;
  height: var(--choice-size);
  min-height: var(--choice-size);
  border-radius: var(--radius-sm);
  border: none;
  text-align: left;
  cursor: pointer;
  font-weight: 600;
  background: transparent;
  color: var(--color-text);

  font-size: 0.98rem;
  line-height: 1.25;

  white-space: normal;
  overflow-wrap: anywhere;
  word-break: break-word;
  text-overflow: unset;

  display: flex;
  align-items: center;
  gap: 10px;

  flex: 0 0 auto;
}
.choice:hover {
  transform: translateX(6px);
  transition: transform 160ms ease;
  box-shadow: var(--shadow-1);
}
.choice:focus {
  outline: 2px solid var(--focus-ring);
  outline-offset: 2px;
  box-shadow: none;
}

/* scrollbar visuals */
.popupInner::-webkit-scrollbar { width: 8px; }
.popupInner::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, var(--color-primary-med), var(--color-primary));
  border-radius: 999px;
  min-height: 28px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.popupInner { scrollbar-width: thin; scrollbar-color: var(--color-primary-med) transparent; }

/* ---------------- Mobile: full-width chooser (<=500px) ---------------- */
@media (max-width: 500px) {
  .chooserPopup {
    left: 0;
    right: 0;
    width: calc(100vw - 50px);
    min-width: unset;
    max-width: none;
    bottom: 68px;

    /* make popup visually sit flush with edges and slightly elevated */
    transform-origin: top center;
    padding: 0 8px; /* container-level padding so inner panel isn't edge-to-edge */
  }

  .popupInner {
    /* slightly tighter radius on mobile and full-width inner padding */
    border-radius: calc(var(--radius-md) - 4px);
    padding: 12px;
    --choice-size: 42px;
    height: calc((var(--choice-size) * 4) + (8px * 3) + 24px);
    max-height: calc((var(--choice-size) * 4) + (8px * 3) + 24px);

    /* ensure full-bleed feel without touching screen edges */
    margin: 0 auto;
    box-sizing: border-box;
  }

  .choice {
    font-size: 1rem;
    gap: 12px;
  }
}
